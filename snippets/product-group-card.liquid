{%- comment -%}
  ============================================================================
  Product Group Card Snippet
  ============================================================================
  
  PURPOSE:
  Renders a product card that can represent either a single product or a group
  of products. When variant_handles are provided, it displays grouped product
  indicators (badge, "X copies available" text, "from" price).
  
  CRITICAL:
  - Uses collection to find variant products by handle (all_products requires IDs)
  - Collection parameter is REQUIRED when called via Section Rendering API
  - Handles both grouped and single products in one snippet
  
  Parameters:
  - main_product {Object} - Main product object to display (REQUIRED)
  - variant_handles {String} - Comma-separated list of variant product handles (optional)
  - group_formats {String} - Comma-separated list of formats in the group (optional)
  - image_ratio {Number} - Aspect ratio for the image(s) (optional)
  - show_compare {Boolean} - Whether to show compare functionality (optional)
  - card_size {String} - Optional card size override ('small', 'medium', 'large')
  - collection {Object} - Collection object (REQUIRED for variant lookup via Section Rendering API)
  
  Usage:
  {% render 'product-group-card', main_product: main_product, variant_handles: variant_products, group_formats: group_formats_string, image_ratio: image_ratio, show_compare: settings.enable_compare, collection: collection %}
  ============================================================================
{%- endcomment -%}

{%- liquid
  assign product = main_product
  
  # Use card_size parameter if provided, otherwise use section.settings.card_size
  if card_size != blank and card_size != ''
    assign effective_card_size = card_size
  else
    assign effective_card_size = section.settings.card_size
  endif
  
  # Handle empty variant_handles properly
  if variant_handles != blank and variant_handles != ''
    assign variant_handles_array = variant_handles | split: ','
    # Filter out any empty strings
    assign group_size = 0
    for handle in variant_handles_array
      if handle != blank and handle != ''
        assign group_size = group_size | plus: 1
      endif
    endfor
  else
    assign variant_handles_array = ''
    assign group_size = 0
  endif
  
  # Use collection parameter if provided, otherwise fall back to product's first collection
  # CRITICAL: We need collection to find variant products by handle (all_products requires IDs, not handles)
  if collection == blank or collection == null
    if product.collections.size > 0
      assign collection = product.collections.first
    endif
  endif
  
  # For grouped products, find the lowest price across all grouped products
  # CRITICAL: Use collection to search for variant products by handle (all_products[handle] doesn't work)
  assign lowest_price = product.price
  assign show_from_price = false
  if group_size > 0 and collection
    assign show_from_price = true
    # Search collection for each variant product by handle
    for handle in variant_handles_array
      if handle != blank and handle != ''
        # Search collection for this variant product
        for variant_product in collection.products
          if variant_product.handle == handle
            if variant_product.price < lowest_price
              assign lowest_price = variant_product.price
            endif
            break
          endif
        endfor
      endif
    endfor
  endif
  
  if collection and settings.card_url_within_coll and product.collections contains collection
    assign product_url = product.url | within: collection
  else
    assign product_url = product.url
  endif

  if product_url contains "?"
    assign product_url = product_url | split: "?" | first
  endif


  assign product_images = product.media | where: 'media_type', 'image'

  if settings.card_hover_action == 'second_image' and product_images.size > 1
    assign show_hover_image = true

    if product_images.size >= product.featured_media.position
      assign hover_image = product_images[product.featured_media.position]
    else
      assign hover_image = product_images[0]
    endif
  else
    assign show_hover_image = false
  endif

  if settings.card_hover_action == 'slideshow' and product_images.size > 1
    assign show_slideshow = true
  endif

  if image_ratio == nil
    if settings.prod_card_image_ratio == 'shortest' or settings.prod_card_image_ratio == 'tallest'
      assign image_ratio = 1
    else
      assign image_ratio = settings.prod_card_image_ratio
    endif
  elsif image_ratio == 0 or image_ratio == 99
    assign image_ratio = 1
  endif

  if effective_card_size == 'small'
    assign swatch_limit = 4
  else
    assign swatch_limit = 7
  endif

  if product.featured_media
    if effective_card_size == 'small'
      capture sizes
        render 'sizes-attribute', grid: true, min: 2, sm: 3, md: 4, xl: 5
      endcapture
    elsif effective_card_size == 'large'
      capture sizes
        render 'sizes-attribute', grid: true, min: 1, sm: 2, xl: 3
      endcapture
    else
      capture sizes
        render 'sizes-attribute', grid: true, min: 1, sm: 3, md: 4
      endcapture
    endif

    # Decide contain vs cover per product
    assign ptype = product.product_type | default: product.type | downcase
    assign fmt = product.metafields.custom.format.value | downcase
    assign is_contain_media = false
    if ptype contains 'book' or ptype contains 'dvd' or ptype contains 'blu' or ptype contains 'cassette' or ptype contains 'magazine' or ptype contains 'vhs'
      assign is_contain_media = true
    elsif fmt contains 'book' or fmt contains 'dvd' or fmt contains 'blu' or fmt contains 'cassette' or fmt contains 'magazine' or fmt contains 'vhs'
      assign is_contain_media = true
    endif

    if is_contain_media
      assign class = 'img-fit img-fit--contain card__main-image'
    else
      assign class = 'img-fit card__main-image ' | append: settings.prod_card_image_align
    endif

    if product.featured_media.preview_image == product_images.last
      assign show_hover_image = false
    endif
  endif

  assign image_quality = 85
  if product.featured_media.preview_image.aspect_ratio > 1 and settings.prod_card_image_ratio != "1.77" and settings.prod_card_image_fit == "cover"
    assign image_quality = 90
  endif

  assign product_not_for_sale = false
  if product.template_suffix contains 'coming-soon' or product.template_suffix contains 'countdown'
    assign product_not_for_sale = true
  endif

  # Only add card--product-group class when it's actually a group
  assign card_class = ""
  if group_size > 0
    assign card_class = " card--product-group"
  endif
  
  if product.template_suffix contains 'preorder'
    assign card_class = card_class | append: " card--product-preorder"
  elsif product.template_suffix contains 'coming-soon'
    assign card_class = card_class | append: " card--product-coming-soon"
  elsif product.template_suffix contains 'countdown'
    assign card_class = card_class | append: " card--product-countdown"
  endif

  if product.metafields.theme.highlight == true
    assign is_highlighted = true
  endif
-%}

{%- comment -%}DEBUG: Parameters received{%- endcomment -%}
<!-- DEBUG CARD: group_formats='{{ group_formats }}' group_size='{{ group_size }}' variant_handles='{{ variant_handles }}' -->

{%- if product and product != empty -%}
  <product-card class="card card--product{{ card_class }} h-full{% if settings.card_contain %} card--product-contained{% endif %}{% unless settings.show_dividers %} card--no-lines{% endunless %}{% if show_compare %} card--product-compare{% endif %} relative flex{% if is_highlighted %} card--highlight-product{% endif %}" data-group-size="{{ group_size }}">

    {%- comment -%}Group indicator{%- endcomment -%}
    {%- if group_size > 0 -%}
      <div class="card__group-indicator absolute top-2 right-2 text-xs px-2 py-1 rounded-full z-10">
        {{ group_size | plus: 1 }} copies available
      </div>
    {%- endif -%}

    {%- if show_compare -%}
      <div class="card__compare no-js-hidden text-sm">
        <input type="checkbox" class="checkbox checkbox--compare js-compare-checkbox" id="compare-{{ product.id }}"
               data-product-id="{{ product.id }}" data-product-url="{{ product_url }}">
        <label for="compare-{{ product.id }}">{{ 'products.compare.switch_label' | t }}</label>
      </div>
    {%- endif -%}

    <div class="card__media{% if show_hover_image %} has-hover-image{% endif %} relative">
      {%- if show_slideshow -%}
        {%- render 'product-card-image-slider',
          product: product,
          product_url: product_url,
          attrs: 'disable-mobile="true"',
          image_ratio: image_ratio,
          image_blend: settings.blend_product_images,
          image_sizes: sizes,
          image_class: class,
          image_quality: image_quality
        -%}
      {%- else -%}
        <a href="{{ product_url }}" aria-label="{{ product.title | escape }}" class="media block relative{% if settings.blend_product_images %} image-blend{% endif %} js-prod-link" style="padding-top: {{ 1 | divided_by: image_ratio | times: 100 }}%;" tabindex="-1">
          {%- if product.featured_media -%}
            {%- capture attributes %}data-media-id="{{ product.featured_media.id }}"{% endcapture -%}
            {% render 'image',
              image: product.featured_media.preview_image,
              widths: '320, 460, 600, 700, 800, 900, 1200',
              src_width: 460,
              sizes: sizes,
              class: class,
              attributes: attributes,
              fetchpriority: 'low',
              disable_focal_point: true,
              quality: image_quality
            %}

            {%- if settings.card_colors_style == 'native' or settings.card_colors_style == 'swatches' or settings.card_colors_style == 'variant-images' -%}
              {%- assign variant_media = product.variants | map: 'featured_media' -%}
              {%- for media in variant_media -%}
                {%- unless media == product.featured_media -%}
                  {%- capture attributes %}data-media-id="{{ media.id }}" hidden{% endcapture -%}
                  {% render 'image',
                    image: media,
                    widths: '320, 460, 600, 700, 800, 900, 1200',
                    src_width: 460,
                    sizes: sizes,
                    class: class,
                    attributes: attributes,
                    fetchpriority: 'low',
                    disable_focal_point: true,
                    quality: image_quality
                  %}
                {%- endunless -%}
              {%- endfor -%}
            {%- endif -%}

            {%- if show_hover_image -%}
              {%- assign class = class | replace: 'card__main-image', 'card__hover-image' -%}
              {% render 'image',
                image: hover_image,
                widths: '320, 460, 600, 700, 800, 900, 1200',
                src_width: 460,
                sizes: sizes,
                class: class,
                fetchpriority: 'low',
                disable_focal_point: true,
                quality: image_quality
              %}
            {%- endif -%}
          {%- else -%}
            {{ 'image' | placeholder_svg_tag: 'media__placeholder img-fit' }}
          {%- endif -%}
        </a>
      {%- endif -%}

      {%- liquid
        if settings.product_label_card_position != "none"
          render 'product-label', product: product, position: settings.product_label_card_position, is_product_card: true, limit: 2
        endif
      -%}
    </div>

    <div class="card__info-container flex flex-col flex-auto relative">
      <div class="card__info w-full">
        <div class="card__info-inner{% if settings.card_price_bottom %} flex flex-col h-full{% else %} inline-block{% endif %} w-full">
          {%- if settings.card_show_vendor -%}
            <p class="card__vendor{% if settings.show_dividers %} mb-1{% else %} mb-0{% endif %} text-sm text-theme-light">
              {{- product.metafields.custom.computed_master_label.value | default: product.vendor -}}
            </p>
          {%- endif -%}

          <p class="card__title font-bold{% if settings.show_dividers %} mb-1{% else %} mt-1 mb-0{% endif %}">
            <a href="{{ product_url }}" class="card-link text-current js-prod-link">
            {%- liquid
              # Extract artist and title from metafields or parse from product title
              assign artist = product.metafields.custom.artist.value | default: ''
              assign album_title = product.metafields.custom.title.value | default: ''
              
              # If metafields are empty, try parsing from product title
              if artist == blank or album_title == blank
                assign title_parts = product.title | split: ' - '
                if title_parts.size >= 2
                  assign artist = title_parts[0] | strip
                  assign album_title = title_parts[1] | strip
                else
                  assign artist = product.vendor | default: ''
                  assign album_title = product.title
                endif
              endif
              
              # Build base title: "artist - title"
              assign base_title = ''
              if artist != blank and album_title != blank
                assign base_title = artist | append: ' - ' | append: album_title
              elsif album_title != blank
                assign base_title = album_title
              else
                assign base_title = product.title
              endif
              
              # Remove ALL format patterns from base title (comprehensive list including "7" not just "7"")
              assign clean_title = base_title
              
              # Remove format patterns with dash (e.g., " - (LP)", " - (7")", " - (7)")
              assign clean_title = clean_title | replace: ' - (LP)', '' | replace: ' - (CD)', '' | replace: ' - (7")', '' | replace: ' - (7)', '' | replace: ' - (12")', '' | replace: ' - (12)', '' | replace: ' - (10")', '' | replace: ' - (10)', '' | replace: ' - (EP)', '' | replace: ' - (DVD)', '' | replace: ' - (Blu-ray)', '' | replace: ' - (Blu-ray)', '' | replace: ' - (Cassette)', '' | replace: ' - (VHS)', ''
              assign clean_title = clean_title | replace: ' - (2xLP)', '' | replace: ' - (2xCD)', '' | replace: ' - (3xLP)', '' | replace: ' - (3xCD)', '' | replace: ' - (2xCassette)', ''
              assign clean_title = clean_title | replace: ' - (LP Box)', '' | replace: ' - (CD Box)', '' | replace: ' - (Box Set)', '' | replace: ' - (Vinyl Box Set)', '' | replace: ' - (CD Box Set)', ''
              
              # Remove format patterns without dash (e.g., "(LP)", "(7")", "(7)")
              assign clean_title = clean_title | replace: ' (LP)', '' | replace: ' (CD)', '' | replace: ' (7")', '' | replace: ' (7)', '' | replace: ' (12")', '' | replace: ' (12)', '' | replace: ' (10")', '' | replace: ' (10)', '' | replace: ' (EP)', '' | replace: ' (DVD)', '' | replace: ' (Blu-ray)', '' | replace: ' (Cassette)', '' | replace: ' (VHS)', ''
              assign clean_title = clean_title | replace: ' (2xLP)', '' | replace: ' (2xCD)', '' | replace: ' (3xLP)', '' | replace: ' (3xCD)', '' | replace: ' (2xCassette)', ''
              assign clean_title = clean_title | replace: ' (LP Box)', '' | replace: ' (CD Box)', '' | replace: ' (Box Set)', '' | replace: ' (Vinyl Box Set)', '' | replace: ' (CD Box Set)', ''
              
              # Remove ALL grading/condition patterns
              assign clean_title = clean_title | replace: ' (Near Mint (NM or M-))', '' | replace: ' (Near Mint (NM Or M-))', '' | replace: ' (Very Good Plus (VG+))', '' | replace: ' (Very Good Plus (VG))', '' | replace: ' (Very Good (VG+))', '' | replace: ' (Very Good (VG))', '' | replace: ' (Good Plus (G+))', '' | replace: ' (Good Plus (G))', '' | replace: ' (Good (G+))', '' | replace: ' (Good (G))', '' | replace: ' (Fair (F))', '' | replace: ' (Poor (P))', '' | replace: ' (Mint (M))', ''
              
              # Generic pattern for any remaining condition in parentheses
              assign title_parts_check = clean_title | split: ' ('
              if title_parts_check.size > 1
                assign last_part = title_parts_check | last
                assign grade_match = last_part | split: ')' | first
                if grade_match contains 'NM' or grade_match contains 'M-' or grade_match contains 'VG+' or grade_match contains 'VG' or grade_match contains 'G+' or grade_match contains 'G' or grade_match contains 'F' or grade_match contains 'P' or grade_match contains 'M'
                  assign pattern_to_remove = ' (' | append: grade_match | append: ')'
                  assign clean_title = clean_title | replace_first: pattern_to_remove, ''
                endif
              endif
              
              # Clean up double spaces and trim
              assign clean_title = clean_title | replace: '  ', ' ' | strip
              
              # Determine if this is a grouped product
              assign is_grouped = false
              if group_formats != blank
                assign is_grouped = true
              endif
              
              # Extract format from product type for display (just the format, not full product type)
              assign raw_product_type = product.product_type | default: product.type | strip
              assign display_format = ''
              
              # Extract format using same logic as grouping
              if raw_product_type != blank
                assign type_lower = raw_product_type | downcase
                if type_lower contains '12'
                  assign display_format = '12"'
                elsif type_lower contains '10'
                  assign display_format = '10"'
                elsif type_lower contains '7'
                  assign display_format = '7"'
                elsif type_lower contains 'box'
                  if type_lower contains 'lp' or type_lower contains 'vinyl'
                    assign display_format = 'LP Box'
                  elsif type_lower contains 'cd'
                    assign display_format = 'CD Box'
                  else
                    assign display_format = 'Box Set'
                  endif
                elsif type_lower contains 'lp'
                  assign display_format = 'LP'
                elsif type_lower contains 'cd'
                  assign display_format = 'CD'
                elsif type_lower contains 'cassette'
                  assign display_format = 'Cassette'
                elsif type_lower contains 'ep'
                  assign display_format = 'EP'
                elsif type_lower contains 'dvd'
                  assign display_format = 'DVD'
                elsif type_lower contains 'blu'
                  assign display_format = 'Blu-ray'
                elsif type_lower contains 'vhs'
                  assign display_format = 'VHS'
                endif
              endif
              
              # Get grade condition for single products only
              assign grade_condition = ''
              if is_grouped == false
                if product.metafields.custom.media_condition.value
                  assign media_abbr = product.metafields.custom.media_condition.value
                  if media_abbr == 'M'
                    assign grade_condition = 'Mint (M)'
                  elsif media_abbr == 'NM' or media_abbr == 'M-' or media_abbr == 'NM or M-'
                    assign grade_condition = 'Near Mint (NM or M-)'
                  elsif media_abbr == 'VG+'
                    assign grade_condition = 'Very Good Plus (VG+)'
                  elsif media_abbr == 'VG'
                    assign grade_condition = 'Very Good (VG)'
                  elsif media_abbr == 'G+' or media_abbr == 'Good Plus'
                    assign grade_condition = 'Good Plus (G+)'
                  elsif media_abbr == 'G' or media_abbr == 'Good'
                    assign grade_condition = 'Good (G)'
                  elsif media_abbr == 'F' or media_abbr == 'Fair'
                    assign grade_condition = 'Fair (F)'
                  elsif media_abbr == 'P' or media_abbr == 'Poor'
                    assign grade_condition = 'Poor (P)'
                  endif
                endif
              endif
              
              -%}
              
              {{- clean_title -}}
              {%- comment -%}Add format and condition dynamically{%- endcomment -%}
              {%- if display_format != blank -%}
                <span> - {{ display_format }}</span>
              {%- endif -%}
              {%- if is_grouped == false and grade_condition != blank -%}
                <span style="font-weight: bold; font-style: italic;"> - {{ grade_condition }}</span>
              {%- endif -%}
            </a>
          </p>

          {%- comment -%}Show group info{%- endcomment -%}
          {%- if group_size > 0 -%}
            <p class="card__group-info text-xs text-theme-light mb-1">
              {{ group_size | plus: 1 }} copies available.
            </p>
          {%- endif -%}

          {%- if settings.card_show_subtitle and product.metafields.descriptors.subtitle != blank -%}
            <p class="card__subtitle text-sm text-current mb-1{% unless settings.show_dividers %} mt-1{% endunless %}">
              {{ product.metafields.descriptors.subtitle }}
            </p>
          {%- endif -%}

          {%- if settings.card_show_weight -%}
            <p class="card__weight text-sm mb-1{% unless settings.show_dividers %} mt-1{% endunless %}">
              {%- render 'product-weight', product: product -%}
            </p>
          {%- endif -%}

          {%- if product.metafields.reviews.rating.value != blank and settings.card_show_rating -%}
            <div>
              {% render 'rating',
                rating_value: product.metafields.reviews.rating.value,
                rating_count: product.metafields.reviews.rating_count
              %}
            </div>
          {%- endif -%}

          {%- if settings.card_price_bottom == false -%}
            {%- if show_from_price -%}
              {%- liquid
                assign from_text = 'from'
                if group_formats != blank
                  assign format_array = group_formats | split: ','
                  if format_array.size > 1
                    assign from_text = 'various formats from'
                  else
                    assign from_text = 'various from'
                  endif
                endif
              # DEBUG PRICE: group_formats='{{ group_formats }}' format_array_size='{{ format_array.size }}' from_text='{{ from_text }}'
              -%}
              <div class="price price--top">
                <div class="price__default">
                  <span class="price__current">
                    <span class="price__from">{{ from_text }}</span>
                    <span class="js-value">
                      {%- render 'price-as-money', price: lowest_price -%}
                    </span>
                  </span>
                </div>
              </div>
            {%- else -%}
              {%- render 'price', product: product, class: "price--top" -%}
            {%- endif -%}
          {%- endif -%}

          {%- comment -%}Color swatches for grouped products{%- endcomment -%}
          {%- if settings.card_colors_style != 'none' -%}
            {%- liquid
              assign native_swatch_options = settings.native_swatch_options | split: ','
              assign is_native_swatch = false
              assign swatch_option = null
              
              for option in product.options_with_values
                if settings.card_colors_style == 'native' and native_swatch_options.size > 0
                  assign is_native_swatch = true
                endif
                
                if is_native_swatch or settings.swatch_option_name contains option.name
                  assign swatch_option = option
                  break
                endif
              endfor
            -%}
            
            {%- if swatch_option -%}
              <div class="card__swatches{% if settings.show_dividers %} mt-3 border-top{% else %} mt-2 pb-1{% endif %} pt-3 flex items-start relative">
                {%- for value in swatch_option.values limit: swatch_limit -%}
                  <span class="swatch swatch--{{ settings.card_colors_size }} swatch--{{ settings.card_colors_shape }} mr-1 mb-1" 
                        style="background-color: {{ value | handle }};" 
                        title="{{ value | escape }}"></span>
                {%- endfor -%}
                {%- if swatch_option.values.size > swatch_limit -%}
                  <span class="text-xs text-theme-light">+{{ swatch_option.values.size | minus: swatch_limit }}</span>
                {%- endif -%}
              </div>
            {%- endif -%}
          {%- endif -%}

          {%- if settings.card_price_bottom -%}
            <div class="mt-auto">
              {%- if show_from_price -%}
                {%- liquid
                  assign from_text = 'from'
                  if group_formats != blank
                    assign format_array = group_formats | split: ','
                  if format_array.size > 1
                    assign from_text = 'various formats from'
                  else
                    assign from_text = 'various from'
                  endif
                  endif
                  # DEBUG PRICE2: group_formats='{{ group_formats }}' format_array_size='{{ format_array.size }}' from_text='{{ from_text }}'
                -%}
                <div class="price price--bottom">
                  <div class="price__default">
                    <span class="price__current">
                      <span class="price__from">{{ from_text }}</span>
                      <span class="js-value">
                        {%- render 'price-as-money', price: lowest_price -%}
                      </span>
                    </span>
                  </div>
                </div>
              {%- else -%}
                {%- render 'price', product: product, class: "price--bottom" -%}
              {%- endif -%}
            </div>
          {%- endif -%}
        </div>
      </div>

      {%- unless product_not_for_sale -%}
        <div class="card__actions">
          {%- if product.has_only_default_variant and settings.enable_quick_buy and disable_quickbuy != true -%}
            <product-form class="product-form">
              {%- form 'product', product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
                <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                <button type="submit"
                        name="add"
                        class="btn btn--primary w-full quick-add-btn"
                        aria-haspopup="dialog"
                        aria-labelledby="{{ product_form_id }}-submit title-{{ section.id }}-{{ product.id }}"
                        aria-live="polite"
                        data-sold-out-message="true"
                        {% if product.selected_or_first_available_variant.available == false %}disabled{% endif %}>
                  <span class="quick-add-btn-icon block pointer-events-none">
                    <span class="visually-hidden">View product</span>
                    {% render 'icon-add-to-cart' %}
                  </span>
                  <span class="quick-add-btn-text block pointer-events-none">
                    {%- if product.selected_or_first_available_variant.available -%}
                      View product
                    {%- else -%}
                      {{- 'products.product.sold_out' | t -}}
                    {%- endif -%}
                  </span>
                </button>
              {%- endform -%}
            </product-form>
          {%- else -%}
            <div class="no-js-hidden">
              <button type="button"
                      class="btn btn--primary w-full js-quick-add{% if group_size > 0 %} btn--select-copy{% endif %}"
                      aria-haspopup="dialog"
                      data-product-url="{{ product_url }}"
                      data-product-default-variant="{{ product.has_only_default_variant }}"
                      data-group-variants="{{ variant_handles }}">
                <span class="quick-add-btn-icon block pointer-events-none">
                  <span class="visually-hidden">{{- 'products.product.choose_options' | t -}}</span>
                  {% render 'icon-add-to-cart' %}
                </span>
                <span class="quick-add-btn-text block pointer-events-none">
                  {%- if group_size > 0 -%}
                    CHOOSE COPY (from {{ group_size | plus: 1 }})
                  {%- else -%}
                    {{- 'products.product.choose_options' | t -}}
                  {%- endif -%}
                </span>
              </button>
              <a href="{{ product_url }}" class="btn btn--secondary quick-add-view-btn">
                {{- 'products.product.view_details' | t -}}
              </a>
            </div>
          {%- endif -%}
        </div>
      {%- endunless -%}
    </div>
  </product-card>
{%- else -%}
  <div class="card">
    <div class="card__media">
      <div class="media relative" style="padding-top: {{ 1 | divided_by: image_ratio | times: 100 }}%;">
        {%- capture placeholder_name -%}product-{{ 'now' | date: '%N' | modulo: 6 | plus: 1 }}{%- endcapture -%}
        {{ placeholder_name | placeholder_svg_tag: 'media__placeholder img-fit' }}
      </div>
    </div>
    <div class="card__info">
      <p class="card__title font-bold">{{ 'onboarding.product.title' | t }}</p>
      <div class="card__price theme-money">
        {%- render 'price-as-money', price: 1234 -%}
      </div>
    </div>
  </div>
{%- endif -%}